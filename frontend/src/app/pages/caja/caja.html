<main class="caja-container">
  <!-- Encabezado -->
  <h2>Sistema de caja</h2>

  <!-- Resumen de totales -->
  <div class="resumen-boxes">
    <div><strong>Saldo actual:</strong> ${{ calcularSaldo().toFixed(2) }}</div>
    <div class="ingresos-box">
      <span class="badge verde">{{ contarIngresos() }}</span>
      <strong>Total de ingresos:</strong> ${{ calcularIngresos().toFixed(2) }}
    </div>
    <div class="egresos-box">
      <span class="badge rojo">{{ contarEgresos() }}</span>
      <strong>Total de egresos:</strong> ${{ calcularEgresos().toFixed(2) }}
    </div>
  </div>

  <!-- Botones de acción -->
  <div class="acciones-box">
    <button class="btn-editar-principal" (click)="mostrarModalEditarMonto = true">Editar monto inicial</button>
    <button class="btn-registrar" (click)="mostrarModalRegistrar = true">Registrar Transacción</button>
    <button class="btn-descargar" (click)="descargarReportePDF()">
      <i class="fa fa-download"></i> Descargar reporte
    </button>
  </div>

  <!-- Modal para Editar Monto Inicial -->
  @if (mostrarModalEditarMonto) {
    <div class="modal">
      <div class="modal-contenido">
        <span class="cerrar-modal" (click)="mostrarModalEditarMonto = false">&times;</span>
        <h3>Editar Monto inicial</h3>
        <p>Todos los campos con "*" son obligatorios</p>
        
        <form (ngSubmit)="actualizarMontoInicial()">
          <div class="form-group">
            <label for="montoInicial">Monto*</label>
            <input type="number" id="montoInicial" [(ngModel)]="montoInicial" name="montoInicial" step="0.01" min="0" placeholder="Ingresa Monto Inicial" required>
          </div>
          
          <div class="form-group">
            <label for="fechaTransaccion">Fecha de Transacción*</label>
            <input type="date" id="fechaTransaccion" [(ngModel)]="fechaTransaccion" name="fechaTransaccion" required>
          </div>
          
          <button type="submit" class="btn-actualizar">Actualizar monto</button>
        </form>
      </div>
    </div>
  }

  <!-- Modal para Registrar Transacción -->
  @if (mostrarModalRegistrar) {
    <div class="modal">
      <div class="modal-contenido">
        <span class="cerrar-modal" (click)="mostrarModalRegistrar = false">&times;</span>
        <h3>Registrar Nueva Transacción</h3>
        <p>Todos los campos con "*" son obligatorios</p>
        
        <form (ngSubmit)="registrarTransaccion()">
          <div class="form-group">
            <label for="tipoTransaccion">Tipo de Transacción*</label>
            <select id="tipoTransaccion" [(ngModel)]="nuevaTransaccion.tipo" name="tipoTransaccion" required>
              <option value="">Seleccione...</option>
              <option value="Ingreso">Ingreso</option>
              <option value="Egreso">Egreso</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="usuario">Usuario*</label>
            <input type="text" id="usuario" [(ngModel)]="nuevaTransaccion.usuario" name="usuario" placeholder="Nombre del usuario" required>
          </div>
          
          <div class="form-group">
            <label for="montoTransaccion">Monto*</label>
            <input type="number" id="montoTransaccion" [(ngModel)]="nuevaTransaccion.monto" name="montoTransaccion" step="0.01" min="0" placeholder="Ingrese el monto" required>
          </div>
          
          <div class="form-group">
            <label for="fechaTransaccionRegistro">Fecha de Transacción*</label>
            <input type="date" id="fechaTransaccionRegistro" [(ngModel)]="nuevaTransaccion.fecha" name="fechaTransaccionRegistro" required>
          </div>
          
          <button type="submit" class="btn-registrar-transaccion">Registrar Transacción</button>
        </form>
      </div>
    </div>
  }

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="tabla-caja">
      <thead>
        <tr>
          <th>N°</th>
          <th>Usuario</th>
          <th>Transacción</th>
          <th>Monto</th>
          <th>Fecha de transacción</th>
          <th>Opciones</th>
        </tr>
      </thead>
      <tbody>
        @for (item of transacciones; track $index) {
          <tr>
            <td>{{ $index + 1 }}</td>
            <td>{{ item.usuario }}</td>
            <td>{{ item.tipo }}</td>
            <td>${{ item.monto.toFixed(2) }}</td>
            <td>{{ item.fecha }}</td>
            <td class="acciones">
              <button class="btn-ver"><i class="fa fa-eye"></i></button>
              <button class="btn-editar"><i class="fa fa-pen"></i></button>
              <button class="btn-eliminar" (click)="eliminarTransaccion($index)"><i class="fa fa-trash"></i></button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</main>